"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}(),Qtree=function(){function n(t,e,a){_classCallCheck(this,n);var i={branchFormatter:'<div class="QTree-branch">\n                          <span class="tree-content name" name></span>\n                          <div class="edit-container"><span class="btn edit-btn">编辑</span></div>\n                        </div>',limit:"auto",switchClass:".switch",icon:"",openID:"",branchClickEvent:"",renderData:["name"],openBranch:0};this.setting=a?Object.assign(i,a):i,this.nodeData=e,this.container=$(t),this.init()}return _createClass(n,[{key:"init",value:function(){this.initData(),this.createTree(),this.setSwitchEvent()}},{key:"initData",value:function(){this.nodeData.splice(0,0,{id:"0",pid:"",name:"root",open:!0}),this.setOpenBranchArr(),this.sortNodes(this.nodeData)}},{key:"setOpenBranchArr",value:function(){var n=Number(this.setting.openBranch);if(n||Math.floor(n)==n){var t=[];this.findOpenBranch(n,null,t),this.setting.openBranch=t}}},{key:"findOpenBranch",value:function(n,t,e){if(0==n)return e.push(n),"0";if(""!==t){if(t){var a=this.nodeData.find(function(n){return n.id===t});return e.push(a.id),this.findOpenBranch(n,a.pid,e)}var i=this.nodeData.find(function(t){return t.id==n});return e.push(n),this.findOpenBranch(n,i.pid,e)}}},{key:"sortNodes",value:function(n){function t(n,i,r,c){n&&n.child.forEach(function(c,s){n.child[s].sortID=i+n.child[s].sortID,r.push(n.child[s]);var h=e.setting.openBranch.find(function(t){return t==n.child[s].id}),o=e.nodeData.find(function(t){return t.pid===n.child[s].id});n.child[s].open=void 0!=h&&void 0!=o,t(a[n.child[s].id],n.child[s].sortID,r)})}var e=this;!function(n){var i=[];t((a=function(n){if(n){for(var t={},e=0;e<n.length;e++)if(t[n[e].pid]){var a=1*t[n[e].pid].i+1;t[n[e].pid].i=a,n[e].sortID=1*a<10?"000"+a:1*a>100?"00"+a:1*a>1e3?a:"0"+a,t[n[e].pid].child.push(n[e])}else t[n[e].pid]={},t[n[e].pid].i=1,t[n[e].pid].child=[],n[e].sortID="0001",t[n[e].pid].child.push(n[e]);return t}}(n))[""],"",i),e.nodeData=i}(n);var a=null}},{key:"createTree",value:function(){var n=this,t=$(document.createDocumentFragment());this.nodeData.forEach(function(e,a){e.pid?(t.find("#children_"+e.pid).append(n.createBranch(e)),t.find("#container_"+e.id).append(n.createBranchContainer(e.id,e.open))):t.append(n.createBranchContainer(e.id,e.open))}),this.container.empty().append(t)}},{key:"createBranchContainer",value:function(n,t){return'<div class="QTree-children-container '+(t?"":"QTree-hide")+'" id="children_'+n+'"></div>'}},{key:"createBranch",value:function(n){var t=$(this.setting.branchFormatter);t.data("treeData",n);var e=this.createEmptySpan(n.sortID);this.loadBranchData(t,n);var a=this.createSwitch(n);t.prepend(a),t.prepend(e),t.attr("id",n.id),t.hasClass("QTree-branch")||t.addClass("QTree-branch");var i=$('<div class="QTree-branch-container" id="container_'+n.id+'"></div>');return i.append(t),i}},{key:"loadBranchData",value:function(n,t){var e=this,a=this;n.children().each(function(n,i){e.setting.renderData.forEach(function(n,e){i.hasAttribute(n)&&t[n]&&(i.innerHTML=t[n])}),$(i).children().length&&a.loadBranchData($(i),t)})}},{key:"hasChildren",value:function(n){return!!this.nodeData.find(function(t,e){return t.pid===n})}},{key:"createSwitch",value:function(n){return void 0!=this.nodeData.find(function(t){return t.pid==n.id})?n.open?'<i class="switch minus-btn" data-switch="true"></i>':'<i class="switch plus-btn" data-switch="false"></i>':'<span class="empty-span"></span>'}},{key:"createEmptySpan",value:function(n){for(var t=function(n){return n?n.length/4-2:0}(n),e="",a=0;a<t;a++)e+='<span class="empty-span"></span>';return e}},{key:"syncData",value:function(n,t){var e=this.container.find("#"+n);for(var a in t)e.data("treeData")[a]=t[a]}},{key:"onchangeBranch",value:function(n){}},{key:"openBranch",value:function(n){this.container.find("#children_"+n).removeClass("QTree-hide"),this.syncData(n,{open:!0})}},{key:"closeBranch",value:function(n){this.container.find("#children_"+n).addClass("QTree-hide"),this.syncData(n,{open:!1})}},{key:"setSwitchEvent",value:function(){var n=this;this.container.on("click",".switch",function(t){t.stopPropagation();var e=$(this).attr("data-switch"),a=$(this).parents(".QTree-branch").data("treeData").id;switch(e){case"true":n.closeBranch(a),$(this).attr("data-switch","false").removeClass("minus-btn").addClass("plus-btn");break;case"false":n.openBranch(a),$(this).attr("data-switch","true").removeClass("plus-btn").addClass("minus-btn")}})}},{key:"updateBranch",value:function(n,t){if("[object Object]"==Object.prototype.toString.call(t)){var e=this.container.find("#"+n);if(e.length){var a=e.data("treeData"),i={};for(var r in t)tkey in a&&t[r]!=a[r]&&(i[r]=t[r]);Object.keys(i).length&&(this.updateBranchData(e,i),this.syncData(n,i))}}}},{key:"updateBranchData",value:function(n,t){var e=this;n.children().each(function(n,a){for(var i in t)a.hasAttribute(i)&&(a.innerHTML=t[i]);$(a).children().length&&e.updateBranchData($(a),t)})}},{key:"removeBranch",value:function(n){var t=this.container.find("#"+n);t.length&&t.parent().remove()}},{key:"checkChlidren",value:function(n){return!!this.container.find("#"+n).siblings(".QTree-children-container").length}},{key:"addBranch",value:function(n,t){var e=$("children_"+n);if(e.length){var a=this.createBranch(t);e.append(a)}}}]),n}();