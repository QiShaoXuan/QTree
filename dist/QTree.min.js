"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),Qtree=function(){function e(n,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e);this.setting=Object.assign({branchFormatter:'<div class="QTree-branch">\n                          <span class="tree-content" name></span>\n                        </div>',renderData:["name"],openBranch:[],needLine:!0,isTile:!0,openAnimate:!0},a),this.cloneData=t,this.container=$(n),this.nodeData,this.init()}return _createClass(e,[{key:"init",value:function(){this.initData(),this.createTree(),this.initEvent()}},{key:"initData",value:function(){var e=this;if(this.setting.isTile){var n=this.cloneData.filter(function(e){return 0==e.pid});n.forEach(function(n){e.findChildrenDown(n,n.id)}),this.nodeData=n}else this.nodeData=this.cloneData}},{key:"findChildrenDown",value:function(e,n){var t=this,a=this.cloneData.filter(function(e){return e.pid==n});a.length?(e.children=a,e.children.forEach(function(e){t.findChildrenDown(e,e.id)})):e.children=[]}},{key:"createTree",value:function(){var e=this,n=$('<ul class="QTree-children-container QTree"></ul>');this.nodeData.forEach(function(t){n.append(e.createBranch(t))}),this.container.empty().append(n)}},{key:"createBranch",value:function(e){var n=this.setting.needLine?" Qtree-line":"",t=$('<li class="QTree-branch-container'+n+'"><ul class="QTree-children-container" style="display: none"></ul></li>');return t.find("ul").append(this.setChildren(e.children)),t.prepend(this.createFormatter(e)),t}},{key:"createFormatter",value:function(e){var n=$(this.setting.branchFormatter);return n.hasClass("QTree-branch")||n.addClass("QTree-branch"),this.loadBranchData(n,e),n.prepend(this.setSwitch(e)),n}},{key:"setSwitch",value:function(e){return e.children.length?'<span class="switch plus-btn"></span>':'<span class="empty-span"></span>'}},{key:"loadBranchData",value:function(e,n){var t=this,a=this;e.children().each(function(e,i){t.setting.renderData.forEach(function(e,t){i.hasAttribute(e)&&n[e]&&(i.innerHTML=n[e])}),$(i).children().length&&a.loadBranchData($(i),n)})}},{key:"setChildren",value:function(e){var n=this,t=$(document.createDocumentFragment());return e.forEach(function(e){t.append(n.createBranch(e))}),t}},{key:"initEvent",value:function(){this.setSwitchEvent()}},{key:"setSwitchEvent",value:function(){var e=this;this.container.on("click",".switch",function(n){n.stopPropagation();var t=$(this),a=t.hasClass("plus-btn"),i=t.parents(".QTree-branch").siblings(".QTree-children-container");a?(t.removeClass("plus-btn").addClass("minus-btn"),e.setting.openAnimate?i.slideDown(150):i.show()):(t.removeClass("minus-btn").addClass("plus-btn"),e.setting.openAnimate?i.slideUp(150):i.hide())})}}]),e}();