"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),Qtree=function(){function n(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,n);this.setting=Object.assign({branchFormatter:'<div class="QTree-branch">\n                          <span class="tree-content" name></span>\n                        </div>',renderData:["name"],openBranch:[],needLine:!0,isTile:!0,openAnimate:!0,openAnimateDuration:150},i),this.cloneData=t,this.container=$(e),this.nodeData,this.init()}return _createClass(n,[{key:"init",value:function(){this.initData(),this.createTree(),this.initEvent()}},{key:"initData",value:function(){var n=this;if(this.setting.isTile){var e=this.cloneData.filter(function(n){return 0==n.pid});e.forEach(function(e){n.findChildrenDown(e,e.id)}),this.nodeData=e}else this.nodeData=this.cloneData}},{key:"findChildrenDown",value:function(n,e){var t=this,i=this.cloneData.filter(function(n){return n.pid==e});i.length?(n.children=i,n.children.forEach(function(n){t.findChildrenDown(n,n.id)})):n.children=[]}},{key:"createTree",value:function(){var n=this,e=$('<ul class="QTree-children-container QTree"></ul>');this.nodeData.forEach(function(t){e.append(n.createBranch(t))}),this.container.empty().append(e)}},{key:"createBranch",value:function(n){"children"in n||(n.children=[]);var e=this.setting.needLine?" Qtree-line":"",t=!1;this.setting.openBranch.length&&(t=this.setting.openBranch.find(function(e){return e==n.id}));var i=$('<li class="QTree-branch-container'+e+'"><ul class="QTree-children-container" style="display: '+(t?"block":"none")+'"></ul></li>');return i.find("ul").append(this.setChildren(n.children)),i.prepend(this.createFormatter(n,t)),i}},{key:"createFormatter",value:function(n,e){var t=$(this.setting.branchFormatter);return t.hasClass("QTree-branch")||t.addClass("QTree-branch"),t.addClass("branch_"+n.id),t.data("treeData",n),this.loadBranchData(t,n),t.prepend(this.setSwitch(n,e)),t}},{key:"setSwitch",value:function(n,e){return e&&n.children.length?'<span class="switch minus-btn"></span>':n.children.length?'<span class="switch plus-btn"></span>':'<span class="empty-span"></span>'}},{key:"loadBranchData",value:function(n,e){var t=this,i=this;n.children().each(function(n,a){t.setting.renderData.forEach(function(n,t){a.hasAttribute(n)&&e[n]&&(a.innerHTML=e[n])}),$(a).children().length&&i.loadBranchData($(a),e)})}},{key:"setChildren",value:function(n){var e=this;if(!n.length)return"";var t=$(document.createDocumentFragment());return n.forEach(function(n){t.append(e.createBranch(n))}),t}},{key:"initEvent",value:function(){this.setSwitchEvent()}},{key:"setSwitchEvent",value:function(){var n=this;this.container.on("click",".switch",function(e){e.stopPropagation();var t=$(this),i=t.hasClass("plus-btn"),a=t.parents(".QTree-branch").siblings(".QTree-children-container");i?(t.removeClass("plus-btn").addClass("minus-btn"),n.setting.openAnimate?a.slideDown(n.setting.openAnimateDuration):a.show()):(t.removeClass("minus-btn").addClass("plus-btn"),n.setting.openAnimate?a.slideUp(n.setting.openAnimateDuration):a.hide())})}},{key:"openBranch",value:function(n){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0!=n){var t=this.container.find(".branch_"+n),i=t.siblings(".QTree-children-container");i.children().length&&i.is(":hidden")&&(t.find(".switch").addClass("minus-btn").removeClass("plus-btn"),this.setting.openAnimate?i.slideDown(this.setting.openAnimateDuration):i.show(),e&&this.openBranch(t.data("treeData").pid,!0))}}},{key:"closeBranch",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=this.container.find(".branch_"+n),i=t.siblings(".QTree-children-container");if(i.children().length&&!i.is(":hidden")&&(t.find(".switch").removeClass("minus-btn").addClass("plus-btn"),this.setting.openAnimate?i.slideUp(this.setting.openAnimateDuration):i.hide(),e)){var a=this;this.container.find(".branch_"+n).data("treeData").children.forEach(function(n){a.closeBranch(n.id,!0)})}}},{key:"addBranch",value:function(n,e){if("id"in e&&"pid"in e){var t=this.createBranch(e);if(0==n)return this.container.find(".QTree").append(t);var i=this.container.find(".branch_"+n),a=i.siblings(".QTree-children-container");a.children().length||i.prepend('<span class="switch plus-btn"></span>').find(".empty-span").remove(),a.append(t)}}},{key:"removeBranch",value:function(n){var e=this.container.find(".branch_"+n),t=e.parent(),i=e.data("treeData");if(t.remove(),!this.checkChlidren(i.pid)){this.container.find(".branch_"+i.pid).prepend('<span class="empty-span"></span>').find(".switch").remove()}}},{key:"checkChlidren",value:function(n){return!!this.container.find(".branch_"+n).siblings(".QTree-children-container").children().length}},{key:"updateBranch",value:function(n,e){var t=this.container.find(".branch_"+n),i=t.data("treeData"),a=Object.assign(i,e);t.data("treeData",a),this.loadBranchData(t,e)}},{key:"getTreeData",value:function(n){if(n)return this.container.find(".branch_"+n).data("treeData");var e=[];return this.container.find(".QTree-branch").each(function(n,t){e.push($(t).data("treeData"))}),e}},{key:"moveBranch",value:function(n,e){var t=this.container.find(".branch_"+n).parent().clone(!0),i=this.container.find(".branch_"+e).siblings(".QTree-children-container");this.removeBranch(n),i.append(t)}},{key:"closeAllBranch",value:function(){var n=this;this.container.find(".QTree-branch").each(function(e,t){var i=$(t),a=$(t).siblings(".QTree-children-container");a.children().length&&!a.is(":hidden")&&(i.find(".switch").removeClass("minus-btn").addClass("plus-btn"),n.setting.openAnimate?a.slideUp(n.setting.openAnimateDuration):a.hide())})}},{key:"openAllBranch",value:function(){var n=this;this.container.find(".QTree-branch").each(function(e,t){var i=$(t),a=$(t).siblings(".QTree-children-container");a.children().length&&a.is(":hidden")&&(i.find(".switch").addClass("minus-btn").removeClass("plus-btn"),n.setting.openAnimate?a.slideDown(n.setting.openAnimateDuration):a.show())})}},{key:"findParent",value:function(n){var e=this.container.find(".branch_"+n),t=e.data("treeData");return{$parentDom:this.container.find(".branch_"+t.pid),$parentContainer:e.parent().parent()}}}]),n}();